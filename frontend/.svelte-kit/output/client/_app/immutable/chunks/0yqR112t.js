import{d,w as m}from"./D2lGS4wI.js";function W(){const{subscribe:n,set:a,update:s}=m({status:"disconnected",lastMessage:null,error:null});let e=null,l=null,r=0;const u=5,k=3e3;function p(){const c="ws://localhost:8000/ws";try{s(t=>({...t,status:"connecting",error:null})),e=new WebSocket(c),e.onopen=()=>{console.log("WebSocket connected"),r=0,s(o=>({...o,status:"connected"}));const t=localStorage.getItem("authToken");t&&e&&e.send(JSON.stringify({type:"auth",token:t}))},e.onmessage=t=>{try{const o=JSON.parse(t.data);s(f=>({...f,lastMessage:o})),S(o)}catch(o){console.error("Failed to parse WebSocket message:",o)}},e.onerror=t=>{console.error("WebSocket error:",t),s(o=>({...o,status:"error",error:"WebSocket connection error"}))},e.onclose=()=>{console.log("WebSocket disconnected"),s(t=>({...t,status:"disconnected"})),r<u?(r++,console.log(`Reconnecting... (attempt ${r}/${u})`),l=setTimeout(()=>{p()},k*r)):s(t=>({...t,error:"Failed to reconnect after multiple attempts"}))}}catch(t){console.error("Failed to create WebSocket connection:",t),s(o=>({...o,status:"error",error:"Failed to create WebSocket connection"}))}}function b(){l&&(clearTimeout(l),l=null),e&&e.readyState===WebSocket.OPEN&&e.close(),e=null,r=0}function g(c){e&&e.readyState===WebSocket.OPEN?e.send(JSON.stringify(c)):console.error("WebSocket is not connected")}function S(c){switch(c.type){case"trade_update":console.log("Trade update:",c.data);break;case"price_update":console.log("Price update:",c.data);break;case"notification":console.log("Notification:",c.data);break;case"market_status":console.log("Market status:",c.data);break}}return{subscribe:n,connect:p,disconnect:b,send:g}}const i=W(),w=d(i,n=>n.status==="connected");d(i,n=>{var a;return((a=n.lastMessage)==null?void 0:a.type)==="trade_update"?n.lastMessage.data:null});const M=d(i,n=>{var a;return((a=n.lastMessage)==null?void 0:a.type)==="price_update"?n.lastMessage.data:null});i.connect();export{w as a,M as p,i as w};

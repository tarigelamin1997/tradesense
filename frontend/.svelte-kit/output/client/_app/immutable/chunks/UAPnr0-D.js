import{a as t}from"./Bav7U_R_.js";import{d as c,w as g}from"./D2lGS4wI.js";function d(){const{subscribe:l,set:i,update:o}=g({user:null,loading:!0,error:null});return{subscribe:l,async login(e){o(r=>({...r,loading:!0,error:null}));try{const r=await t.post("/api/v1/auth/login",{username:e.username,password:e.password});if(console.log("Login response:",r),r.access_token){t.setAuthToken(r.access_token);const a=await t.get("/api/v1/auth/me");return o(s=>({...s,user:a,loading:!1,error:null})),{access_token:r.access_token,token_type:"bearer",user:a}}throw new Error("No access token received")}catch(r){throw o(a=>({...a,user:null,loading:!1,error:r.message||"Login failed"})),r}},async register(e){var r,a;o(s=>({...s,loading:!0,error:null}));try{console.log("Attempting to register with:",e);const s=await t.post("/api/v1/auth/register",e);return console.log("Registration successful:",s),await this.login({username:e.username,password:e.password})}catch(s){console.error("Registration error:",s);let n="Registration failed";throw(a=(r=s.detail)==null?void 0:r.details)!=null&&a.message?n=s.detail.details.message:s.message&&(n=s.message),o(u=>({...u,user:null,loading:!1,error:n})),s}},async logout(){t.clearAuth(),i({user:null,loading:!1,error:null})},async checkAuth(){if(!t.isAuthenticated()){i({user:null,loading:!1,error:null});return}o(e=>({...e,loading:!0}));try{const e=await t.get("/api/v1/auth/me");o(r=>({...r,user:e,loading:!1,error:null}))}catch{t.clearAuth(),i({user:null,loading:!1,error:null})}},clearError(){o(e=>({...e,error:null}))}}}const p=d(),m=c(p,l=>!!l.user);export{p as a,m as i};

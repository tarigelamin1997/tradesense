import{S as de,i as fe,s as he,x as j,y as q,t as F,a as P,z as x,A as N,B as H,C as Z,c as pe,u as me,g as _e,b as ye,d as w,f as Y,h as v,E as $,k as I,l as E,p as W,o as D,m as O,q as k,v as B,r as R,w as ve,T as G,R as U,W as ee,e as J,L as te}from"./M0oPezYK.js";import{e as se,u as we,o as be}from"./DSTCGpCL.js";import"./IHki7fMi.js";import{B as ge,F as $e}from"./CJi7Zq_d.js";import{a as ie}from"./D0mxn6V4.js";import{I as Ie,g as ke,a as Te}from"./Ck4FRYpq.js";import{T as Ae}from"./CR0R1PLy.js";import{T as Ce}from"./CVXI2qhL.js";import{T as Se}from"./k_TuXpN0.js";import{w as Ee}from"./D2lGS4wI.js";import{a as M}from"./Bav7U_R_.js";const Pe=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function De(a){let e;const t=a[2].default,s=pe(t,a,a[3],null);return{c(){s&&s.c()},l(n){s&&s.l(n)},m(n,i){s&&s.m(n,i),e=!0},p(n,i){s&&s.p&&(!e||i&8)&&me(s,t,n,n[3],e?ye(t,n[3],i,null):_e(n[3]),null)},i(n){e||(P(s,n),e=!0)},o(n){F(s,n),e=!1},d(n){s&&s.d(n)}}}function Re(a){let e,t;const s=[{name:"lightbulb"},a[1],{iconNode:a[0]}];let n={$$slots:{default:[De]},$$scope:{ctx:a}};for(let i=0;i<s.length;i+=1)n=j(n,s[i]);return e=new Ie({props:n}),{c(){H(e.$$.fragment)},l(i){N(e.$$.fragment,i)},m(i,c){x(e,i,c),t=!0},p(i,[c]){const l=c&3?ke(s,[s[0],c&2&&Te(i[1]),c&1&&{iconNode:i[0]}]):{};c&8&&(l.$$scope={dirty:c,ctx:i}),e.$set(l)},i(i){t||(P(e.$$.fragment,i),t=!0)},o(i){F(e.$$.fragment,i),t=!1},d(i){q(e,i)}}}function Fe(a,e,t){let{$$slots:s={},$$scope:n}=e;const i=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"}],["path",{d:"M9 18h6"}],["path",{d:"M10 22h4"}]];return a.$$set=c=>{t(1,e=j(j({},e),Z(c))),"$$scope"in c&&t(3,n=c.$$scope)},e=Z(e),[i,e,s,n]}class ze extends de{constructor(e){super(),fe(this,e,Fe,Re,he,{})}}const{Map:Le}=Pe;function ne(a,e,t){const s=a.slice();return s[10]=e[t],s}function ae(a){let e,t="AI";return{c(){e=k("span"),e.textContent=t,this.h()},l(s){e=I(s,"SPAN",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-onsjar"&&(e.textContent=t),this.h()},h(){$(e,"class","ai-badge svelte-156sd")},m(s,n){Y(s,e,n)},d(s){s&&w(e)}}}function re(a){let e,t="High Priority";return{c(){e=k("span"),e.textContent=t,this.h()},l(s){e=I(s,"SPAN",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-mpxz5n"&&(e.textContent=t),this.h()},h(){$(e,"class","priority-badge svelte-156sd")},m(s,n){Y(s,e,n)},d(s){s&&w(e)}}}function oe(a){let e,t,s="Action:",n,i=a[10].actionable+"",c;return{c(){e=k("div"),t=k("strong"),t.textContent=s,n=R(),c=B(i),this.h()},l(l){e=I(l,"DIV",{class:!0});var o=E(e);t=I(o,"STRONG",{class:!0,"data-svelte-h":!0}),O(t)!=="svelte-1s2ciei"&&(t.textContent=s),n=D(o),c=W(o,i),o.forEach(w),this.h()},h(){$(t,"class","svelte-156sd"),$(e,"class","actionable svelte-156sd")},m(l,o){Y(l,e,o),v(e,t),v(e,n),v(e,c)},p(l,o){o&4&&i!==(i=l[10].actionable+"")&&J(c,i)},d(l){l&&w(e)}}}function le(a,e){let t,s,n,i,c,l,o=e[10].title+"",d,u,g,y,f,m=e[10].message+"",_,A,T,z;var L=e[3](e[10].type);function V(C,b){return{props:{size:20}}}L&&(i=ee(L,V()));let r=e[10].isAI&&ae(),h=e[10].priority==="high"&&re(),p=e[10].actionable&&oe(e);return{key:a,first:null,c(){t=k("div"),s=k("div"),n=k("div"),i&&H(i.$$.fragment),c=R(),l=k("h3"),d=B(o),u=R(),r&&r.c(),g=R(),h&&h.c(),y=R(),f=k("p"),_=B(m),A=R(),p&&p.c(),this.h()},l(C){t=I(C,"DIV",{class:!0});var b=E(t);s=I(b,"DIV",{class:!0});var S=E(s);n=I(S,"DIV",{class:!0});var K=E(n);i&&N(i.$$.fragment,K),K.forEach(w),c=D(S),l=I(S,"H3",{class:!0});var Q=E(l);d=W(Q,o),Q.forEach(w),u=D(S),r&&r.l(S),g=D(S),h&&h.l(S),S.forEach(w),y=D(b),f=I(b,"P",{class:!0});var X=E(f);_=W(X,m),X.forEach(w),A=D(b),p&&p.l(b),b.forEach(w),this.h()},h(){$(n,"class","insight-icon svelte-156sd"),$(l,"class","svelte-156sd"),$(s,"class","insight-header svelte-156sd"),$(f,"class","svelte-156sd"),$(t,"class",T="insight-card "+ue(e[10].type)+" svelte-156sd"),te(t,"ai-powered",e[10].isAI),this.first=t},m(C,b){Y(C,t,b),v(t,s),v(s,n),i&&x(i,n,null),v(s,c),v(s,l),v(l,d),v(s,u),r&&r.m(s,null),v(s,g),h&&h.m(s,null),v(t,y),v(t,f),v(f,_),v(t,A),p&&p.m(t,null),z=!0},p(C,b){if(e=C,b&4&&L!==(L=e[3](e[10].type))){if(i){G();const S=i;F(S.$$.fragment,1,0,()=>{q(S,1)}),U()}L?(i=ee(L,V()),H(i.$$.fragment),P(i.$$.fragment,1),x(i,n,null)):i=null}(!z||b&4)&&o!==(o=e[10].title+"")&&J(d,o),e[10].isAI?r||(r=ae(),r.c(),r.m(s,g)):r&&(r.d(1),r=null),e[10].priority==="high"?h||(h=re(),h.c(),h.m(s,null)):h&&(h.d(1),h=null),(!z||b&4)&&m!==(m=e[10].message+"")&&J(_,m),e[10].actionable?p?p.p(e,b):(p=oe(e),p.c(),p.m(t,null)):p&&(p.d(1),p=null),(!z||b&4&&T!==(T="insight-card "+ue(e[10].type)+" svelte-156sd"))&&$(t,"class",T),(!z||b&4)&&te(t,"ai-powered",e[10].isAI)},i(C){z||(i&&P(i.$$.fragment,C),z=!0)},o(C){i&&F(i.$$.fragment,C),z=!1},d(C){C&&w(t),i&&q(i),r&&r.d(),h&&h.d(),p&&p.d()}}}function ce(a){let e,t,s,n,i="Analyzing patterns with AI...",c;return t=new ge({props:{size:24,class:"spinning"}}),{c(){e=k("div"),H(t.$$.fragment),s=R(),n=k("p"),n.textContent=i,this.h()},l(l){e=I(l,"DIV",{class:!0});var o=E(e);N(t.$$.fragment,o),s=D(o),n=I(o,"P",{"data-svelte-h":!0}),O(n)!=="svelte-wupavy"&&(n.textContent=i),o.forEach(w),this.h()},h(){$(e,"class","loading-ai svelte-156sd")},m(l,o){Y(l,e,o),x(t,e,null),v(e,s),v(e,n),c=!0},i(l){c||(P(t.$$.fragment,l),c=!0)},o(l){F(t.$$.fragment,l),c=!1},d(l){l&&w(e),q(t)}}}function Me(a){let e,t=[],s=new Le,n,i,c=se(a[2]);const l=d=>d[10].id;for(let d=0;d<c.length;d+=1){let u=ne(a,c,d),g=l(u);s.set(g,t[d]=le(g,u))}let o=a[1]&&ce();return{c(){e=k("div");for(let d=0;d<t.length;d+=1)t[d].c();n=R(),o&&o.c(),this.h()},l(d){e=I(d,"DIV",{class:!0});var u=E(e);for(let g=0;g<t.length;g+=1)t[g].l(u);n=D(u),o&&o.l(u),u.forEach(w),this.h()},h(){$(e,"class","insights-grid svelte-156sd")},m(d,u){Y(d,e,u);for(let g=0;g<t.length;g+=1)t[g]&&t[g].m(e,null);v(e,n),o&&o.m(e,null),i=!0},p(d,u){u&12&&(c=se(d[2]),G(),t=we(t,u,l,1,d,c,s,e,be,le,n,ne),U()),d[1]?o?u&2&&P(o,1):(o=ce(),o.c(),P(o,1),o.m(e,null)):o&&(G(),F(o,1,1,()=>{o=null}),U())},i(d){if(!i){for(let u=0;u<c.length;u+=1)P(t[u]);P(o),i=!0}},o(d){for(let u=0;u<t.length;u+=1)F(t[u]);F(o),i=!1},d(d){d&&w(e);for(let u=0;u<t.length;u+=1)t[u].d();o&&o.d()}}}function Ye(a){let e,t,s,n,i,c,l,o="Personalized recommendations based on your trading patterns",d,u,g;return n=new ge({props:{size:24}}),u=new $e({props:{feature:"ai-insights",userPlan:a[0],$$slots:{default:[Me]},$$scope:{ctx:a}}}),{c(){e=k("div"),t=k("div"),s=k("h2"),H(n.$$.fragment),i=B(`
			AI Trading Insights`),c=R(),l=k("p"),l.textContent=o,d=R(),H(u.$$.fragment),this.h()},l(y){e=I(y,"DIV",{class:!0});var f=E(e);t=I(f,"DIV",{class:!0});var m=E(t);s=I(m,"H2",{class:!0});var _=E(s);N(n.$$.fragment,_),i=W(_,`
			AI Trading Insights`),_.forEach(w),c=D(m),l=I(m,"P",{class:!0,"data-svelte-h":!0}),O(l)!=="svelte-1ert20n"&&(l.textContent=o),m.forEach(w),d=D(f),N(u.$$.fragment,f),f.forEach(w),this.h()},h(){$(s,"class","svelte-156sd"),$(l,"class","svelte-156sd"),$(t,"class","insights-header svelte-156sd"),$(e,"class","insights-container svelte-156sd")},m(y,f){Y(y,e,f),v(e,t),v(t,s),x(n,s,null),v(s,i),v(t,c),v(t,l),v(e,d),x(u,e,null),g=!0},p(y,[f]){const m={};f&1&&(m.userPlan=y[0]),f&8198&&(m.$$scope={dirty:f,ctx:y}),u.$set(m)},i(y){g||(P(n.$$.fragment,y),P(u.$$.fragment,y),g=!0)},o(y){F(n.$$.fragment,y),F(u.$$.fragment,y),g=!1},d(y){y&&w(e),q(n),q(u)}}}function qe(a){const e=[];if(a.length===0)return[{id:"start",type:"tip",title:"Get Started",message:"Start by adding your first trade to see personalized insights.",priority:"high"}];const t=a.filter(r=>r.pnl>0),s=a.filter(r=>r.pnl<0),n=t.length/a.length*100,i=t.length>0?t.reduce((r,h)=>r+h.pnl,0)/t.length:0,c=s.length>0?Math.abs(s.reduce((r,h)=>r+h.pnl,0)/s.length):0,l=c>0?i/c:0,o=new Map;a.forEach(r=>{if(r.strategy){const h=o.get(r.strategy)||{count:0,pnl:0,winRate:0};h.count++,h.pnl+=r.pnl,r.pnl>0&&h.winRate++,o.set(r.strategy,h)}});const d=new Map;a.forEach(r=>{const h=new Date(r.entryDate).getHours(),p=d.get(h)||{count:0,pnl:0};p.count++,p.pnl+=r.pnl,d.set(h,p)}),n>=70?e.push({id:"high-win-rate",type:"strength",title:"Excellent Win Rate",message:`Your win rate of ${n.toFixed(1)}% is exceptional. Focus on increasing position sizes on high-confidence trades.`,priority:"high",actionable:"Consider scaling up positions gradually"}):n<40&&e.push({id:"low-win-rate",type:"weakness",title:"Win Rate Needs Improvement",message:`Your win rate of ${n.toFixed(1)}% is below optimal. Review your entry criteria and consider being more selective.`,priority:"high",actionable:"Focus on quality over quantity"}),l<1.5&&n<60&&e.push({id:"poor-risk-reward",type:"weakness",title:"Risk-Reward Ratio Too Low",message:`Your risk-reward ratio of ${l.toFixed(2)} requires a high win rate. Consider targeting larger profits or tighter stops.`,priority:"high",actionable:"Aim for at least 2:1 reward-to-risk"});let u=null,g=0,y=null,f=100;o.forEach((r,h)=>{const p=r.winRate/r.count*100;p>g&&(u=h,g=p),p<f&&r.count>=5&&(y=h,f=p)}),u&&g>=60&&e.push({id:"best-strategy",type:"strength",title:"Top Performing Strategy",message:`Your "${u}" strategy has a ${g.toFixed(1)}% win rate. Consider allocating more capital to this approach.`,priority:"medium"}),y&&f<40&&e.push({id:"worst-strategy",type:"weakness",title:"Underperforming Strategy",message:`Your "${y}" strategy has only a ${f.toFixed(1)}% win rate. Consider refining or pausing this approach.`,priority:"medium",actionable:"Review and backtest this strategy"});let m=-1,_=0,A=0;if(d.forEach((r,h)=>{r.pnl>_&&r.count>=3&&(m=h,_=r.pnl),r.pnl<A&&r.count>=3&&(A=r.pnl)}),m>=0){const r=`${m}:00-${m+1}:00`;e.push({id:"best-time",type:"opportunity",title:"Optimal Trading Time",message:`You perform best during ${r}. Your total P&L during this hour is $${_.toFixed(2)}.`,priority:"low"})}let T=0;[...a].sort((r,h)=>new Date(r.exitDate).getTime()-new Date(h.exitDate).getTime()).forEach(r=>{r.pnl<0?T++:T=0}),T>=3&&e.push({id:"loss-streak",type:"weakness",title:"Active Loss Streak",message:`You've had ${T} consecutive losses. Consider taking a break to reset mentally and review your approach.`,priority:"high",actionable:"Take a break and review your recent trades"});const L=new Set(a.map(r=>new Date(r.entryDate).toDateString())).size,V=a.length/L;return V>10&&e.push({id:"overtrading",type:"weakness",title:"Possible Overtrading",message:`You average ${V.toFixed(1)} trades per day. High frequency can lead to poor decision making and increased costs.`,priority:"medium",actionable:"Focus on quality setups only"}),a.length<20&&e.push({id:"more-data",type:"tip",title:"Build More Data",message:"Continue logging trades to get more accurate insights and identify patterns in your trading.",priority:"low"}),e.sort((r,h)=>{const p={high:0,medium:1,low:2};return p[r.priority]-p[h.priority]})}function ue(a){switch(a){case"strength":return"green";case"weakness":return"red";case"opportunity":return"blue";case"tip":return"yellow"}}function xe(a,e,t){let s,{trades:n=[]}=e,{userPlan:i="free"}=e,{showAIInsights:c=!0}=e,l=null,o=null,d=!1;async function u(){if(!(!c||i==="free"))try{t(1,d=!0);const[f,m]=await Promise.all([ie.analyzePatterns().catch(()=>null),ie.getEmotionImpact().catch(()=>null)]);l=f,o=m}catch(f){console.error("Failed to fetch AI insights:",f)}finally{t(1,d=!1)}}function g(){const m=[...qe(n)];if(l&&i!=="free"&&(l.patterns.slice(0,3).forEach((_,A)=>{m.push({id:`ai-pattern-${A}`,type:_.win_rate>60?"strength":"weakness",title:_.pattern_name,message:`${_.description} (${_.frequency} occurrences, ${_.win_rate.toFixed(1)}% win rate)`,priority:_.frequency>10?"high":"medium",actionable:_.win_rate>60?"Focus on this pattern":"Review and improve this pattern",isAI:!0})}),l.optimal_conditions&&m.push({id:"ai-optimal",type:"opportunity",title:"AI-Detected Optimal Trading Conditions",message:`Best performance during ${l.optimal_conditions.best_time} on ${l.optimal_conditions.best_day}. Top strategy: ${l.optimal_conditions.best_strategy}`,priority:"high",actionable:"Schedule your trading during these optimal times",isAI:!0})),o&&i==="enterprise"){const _=Object.entries(o.emotion_performance).sort(([,A],[,T])=>T.win_rate-A.win_rate)[0];_&&m.push({id:"ai-emotion",type:"tip",title:"Emotional State Impact",message:`You perform best when feeling "${_[0]}" (${_[1].win_rate.toFixed(1)}% win rate)`,priority:"medium",actionable:"Track your emotional state before trades",isAI:!0})}return m.sort((_,A)=>{const T={high:0,medium:1,low:2};return T[_.priority]-T[A.priority]}).slice(0,8)}ve(()=>{n.length>0&&u()});function y(f){switch(f){case"strength":return Se;case"weakness":return Ce;case"opportunity":return Ae;case"tip":return ze}}return a.$$set=f=>{"trades"in f&&t(4,n=f.trades),"userPlan"in f&&t(0,i=f.userPlan),"showAIInsights"in f&&t(5,c=f.showAIInsights)},t(2,s=g()),[i,d,s,y,n,c]}class Xe extends de{constructor(e){super(),fe(this,e,xe,Ye,he,{trades:4,userPlan:0,showAIInsights:5})}}function He(){const{subscribe:a,set:e,update:t}=Ee([]);return{subscribe:a,setTrades:s=>e(s),addTrade:s=>t(n=>[...n,s]),updateTrade:(s,n)=>t(i=>i.map(c=>c.id===s?{...c,...n}:c)),deleteTrade:s=>t(n=>n.filter(i=>i.id!==s)),reset:()=>e([])}}const Ze=He(),et={async getTrades(a){return M.get("/api/v1/trades/",a)},async getTrade(a){return M.get(`/api/v1/trades/${a}`)},async createTrade(a){return M.post("/api/v1/trades/",a)},async updateTrade(a,e){return M.put(`/api/v1/trades/${a}`,e)},async deleteTrade(a){return M.delete(`/api/v1/trades/${a}`)},async getStats(a){return M.get("/api/v1/trades/stats/",a)},async bulkDelete(a){return M.post("/api/v1/trades/bulk-delete/",{ids:a})},async exportTrades(a="csv"){return await M.get(`/api/v1/trades/export/?format=${a}`,{responseType:"blob"})}};export{ze as L,Xe as T,Ze as a,et as t};

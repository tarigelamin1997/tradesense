<!DOCTYPE html>
<html>
<head>
    <title>Test Dashboard API</title>
</head>
<body>
    <h1>Dashboard API Test</h1>
    <button onclick="testLogin()">1. Login</button>
    <button onclick="testAnalytics()">2. Test Analytics API</button>
    <div id="results"></div>

    <script>
        const API_URL = 'http://localhost:8000';
        let token = null;

        async function testLogin() {
            const resultsDiv = document.getElementById('results');
            try {
                const response = await fetch(`${API_URL}/api/v1/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: 'testuser789',
                        password: 'test789'
                    })
                });
                
                const data = await response.json();
                resultsDiv.innerHTML = `<pre>Login Response: ${JSON.stringify(data, null, 2)}</pre>`;
                
                if (data.access_token) {
                    token = data.access_token;
                    localStorage.setItem('authToken', token);
                    resultsDiv.innerHTML += '<p style="color: green;">Token saved!</p>';
                }
            } catch (error) {
                resultsDiv.innerHTML = `<pre style="color: red;">Error: ${error}</pre>`;
            }
        }

        async function testAnalytics() {
            const resultsDiv = document.getElementById('results');
            const savedToken = localStorage.getItem('authToken') || token;
            
            if (!savedToken) {
                resultsDiv.innerHTML = '<p style="color: red;">No token! Login first.</p>';
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/api/v1/analytics/summary`, {
                    headers: {
                        'Authorization': `Bearer ${savedToken}`
                    }
                });
                
                const data = await response.json();
                resultsDiv.innerHTML = `<pre>Analytics Response: ${JSON.stringify(data, null, 2)}</pre>`;
            } catch (error) {
                resultsDiv.innerHTML = `<pre style="color: red;">Error: ${error}</pre>`;
            }
        }
    </script>
</body>
</html>
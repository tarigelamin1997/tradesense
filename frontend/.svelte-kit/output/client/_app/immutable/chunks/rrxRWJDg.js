import{a}from"./BaPb1MTw.js";import{d as c,w as g}from"./COKI2rXe.js";function p(){const{subscribe:o,set:l,update:t}=g({user:null,loading:!1,error:null});return{subscribe:o,async login(e){t(r=>({...r,loading:!0,error:null}));try{const r=await a.post("/api/v1/auth/login",{username:e.username,password:e.password});if(console.log("Login response:",r),r.access_token){a.setAuthToken(r.access_token);const n=await a.get("/api/v1/auth/me");return t(s=>({...s,user:n,loading:!1,error:null})),{access_token:r.access_token,token_type:"bearer",user:n}}throw new Error("No access token received")}catch(r){throw t(n=>({...n,user:null,loading:!1,error:r.message||"Login failed"})),r}},async register(e){var r,n;t(s=>({...s,loading:!0,error:null}));try{console.log("Attempting to register with:",e);const s=await a.post("/api/v1/auth/register",e);return console.log("Registration successful:",s),await this.login({username:e.username,password:e.password})}catch(s){console.error("Registration error:",s);let i="Registration failed";throw(n=(r=s.detail)==null?void 0:r.details)!=null&&n.message?i=s.detail.details.message:s.message&&(i=s.message),t(u=>({...u,user:null,loading:!1,error:i})),s}},async logout(){a.clearAuth(),l({user:null,loading:!1,error:null})},async checkAuth(){if(!a.isAuthenticated()){l({user:null,loading:!1,error:null});return}t(e=>({...e,loading:!0}));try{const e=await a.get("/api/v1/auth/me");t(r=>({...r,user:e,loading:!1,error:null}))}catch{a.clearAuth(),l({user:null,loading:!1,error:null})}},clearError(){t(e=>({...e,error:null}))}}}const d=p(),w=c(d,o=>!!o.user),m={async verifyEmail(o){return a.post("/api/v1/auth/verify-email",null,{params:{token:o}})},async resendVerification(o){return a.post("/api/v1/auth/resend-verification",null,{params:{email:o}})},async requestPasswordReset(o){return a.post("/api/v1/auth/password-reset",{email:o})},async resetPassword(o,l){return a.post("/api/v1/auth/password-reset/confirm",{token:o,new_password:l})}};export{m as a,d as b,w as i};

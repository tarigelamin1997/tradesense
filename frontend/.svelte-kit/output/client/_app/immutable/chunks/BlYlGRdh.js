import{w as ce}from"./COKI2rXe.js";import{S as ue,i as fe,s as he,d as w,y as q,t as z,a as F,f as L,h as v,z as H,D as I,k as $,l as P,A as O,p as W,o as D,m as M,q as k,B as V,v as B,r as E,w as de,J as N,I as G,L as K,e as j,Z as Q}from"./Lbc7qOuA.js";import{g as ge}from"./D0QH3NT1.js";import{e as X,u as pe,o as me}from"./BPb2qfkA.js";import"./IHki7fMi.js";import{F as ye}from"./CILRknNV.js";import{a as ee}from"./C0JVUqEW.js";import{B as le}from"./Cizz9D3p.js";import{L as _e}from"./B7N1w56-.js";import{T as ve}from"./DT_GQsO_.js";import{T as we}from"./D6w_Jmzs.js";import{T as be}from"./BXNpXYMZ.js";function Ie(){const{subscribe:d,set:e,update:t}=ce([]);return{subscribe:d,setTrades:i=>e(i),addTrade:i=>t(n=>[...n,i]),updateTrade:(i,n)=>t(a=>a.map(h=>h.id===i?{...h,...n}:h)),deleteTrade:i=>t(n=>n.filter(a=>a.id!==i)),reset:()=>e([])}}const Ve=Ie(),{Map:$e}=ge;function te(d,e,t){const i=d.slice();return i[10]=e[t],i}function ie(d){let e,t="AI";return{c(){e=k("span"),e.textContent=t,this.h()},l(i){e=$(i,"SPAN",{class:!0,"data-svelte-h":!0}),M(e)!=="svelte-onsjar"&&(e.textContent=t),this.h()},h(){I(e,"class","ai-badge svelte-156sd")},m(i,n){L(i,e,n)},d(i){i&&w(e)}}}function se(d){let e,t="High Priority";return{c(){e=k("span"),e.textContent=t,this.h()},l(i){e=$(i,"SPAN",{class:!0,"data-svelte-h":!0}),M(e)!=="svelte-mpxz5n"&&(e.textContent=t),this.h()},h(){I(e,"class","priority-badge svelte-156sd")},m(i,n){L(i,e,n)},d(i){i&&w(e)}}}function ne(d){let e,t,i="Action:",n,a=d[10].actionable+"",h;return{c(){e=k("div"),t=k("strong"),t.textContent=i,n=E(),h=B(a),this.h()},l(o){e=$(o,"DIV",{class:!0});var r=P(e);t=$(r,"STRONG",{class:!0,"data-svelte-h":!0}),M(t)!=="svelte-1s2ciei"&&(t.textContent=i),n=D(r),h=W(r,a),r.forEach(w),this.h()},h(){I(t,"class","svelte-156sd"),I(e,"class","actionable svelte-156sd")},m(o,r){L(o,e,r),v(e,t),v(e,n),v(e,h)},p(o,r){r&4&&a!==(a=o[10].actionable+"")&&j(h,a)},d(o){o&&w(e)}}}function re(d,e){let t,i,n,a,h,o,r=e[10].title+"",c,l,g,_,u,m=e[10].message+"",y,A,T,R;var x=e[3](e[10].type);function Y(C,b){return{props:{size:20}}}x&&(a=K(x,Y()));let s=e[10].isAI&&ie(),f=e[10].priority==="high"&&se(),p=e[10].actionable&&ne(e);return{key:d,first:null,c(){t=k("div"),i=k("div"),n=k("div"),a&&V(a.$$.fragment),h=E(),o=k("h3"),c=B(r),l=E(),s&&s.c(),g=E(),f&&f.c(),_=E(),u=k("p"),y=B(m),A=E(),p&&p.c(),this.h()},l(C){t=$(C,"DIV",{class:!0});var b=P(t);i=$(b,"DIV",{class:!0});var S=P(i);n=$(S,"DIV",{class:!0});var J=P(n);a&&O(a.$$.fragment,J),J.forEach(w),h=D(S),o=$(S,"H3",{class:!0});var U=P(o);c=W(U,r),U.forEach(w),l=D(S),s&&s.l(S),g=D(S),f&&f.l(S),S.forEach(w),_=D(b),u=$(b,"P",{class:!0});var Z=P(u);y=W(Z,m),Z.forEach(w),A=D(b),p&&p.l(b),b.forEach(w),this.h()},h(){I(n,"class","insight-icon svelte-156sd"),I(o,"class","svelte-156sd"),I(i,"class","insight-header svelte-156sd"),I(u,"class","svelte-156sd"),I(t,"class",T="insight-card "+oe(e[10].type)+" svelte-156sd"),Q(t,"ai-powered",e[10].isAI),this.first=t},m(C,b){L(C,t,b),v(t,i),v(i,n),a&&H(a,n,null),v(i,h),v(i,o),v(o,c),v(i,l),s&&s.m(i,null),v(i,g),f&&f.m(i,null),v(t,_),v(t,u),v(u,y),v(t,A),p&&p.m(t,null),R=!0},p(C,b){if(e=C,b&4&&x!==(x=e[3](e[10].type))){if(a){N();const S=a;z(S.$$.fragment,1,0,()=>{q(S,1)}),G()}x?(a=K(x,Y()),V(a.$$.fragment),F(a.$$.fragment,1),H(a,n,null)):a=null}(!R||b&4)&&r!==(r=e[10].title+"")&&j(c,r),e[10].isAI?s||(s=ie(),s.c(),s.m(i,g)):s&&(s.d(1),s=null),e[10].priority==="high"?f||(f=se(),f.c(),f.m(i,null)):f&&(f.d(1),f=null),(!R||b&4)&&m!==(m=e[10].message+"")&&j(y,m),e[10].actionable?p?p.p(e,b):(p=ne(e),p.c(),p.m(t,null)):p&&(p.d(1),p=null),(!R||b&4&&T!==(T="insight-card "+oe(e[10].type)+" svelte-156sd"))&&I(t,"class",T),(!R||b&4)&&Q(t,"ai-powered",e[10].isAI)},i(C){R||(a&&F(a.$$.fragment,C),R=!0)},o(C){a&&z(a.$$.fragment,C),R=!1},d(C){C&&w(t),a&&q(a),s&&s.d(),f&&f.d(),p&&p.d()}}}function ae(d){let e,t,i,n,a="Analyzing patterns with AI...",h;return t=new le({props:{size:24,class:"spinning"}}),{c(){e=k("div"),V(t.$$.fragment),i=E(),n=k("p"),n.textContent=a,this.h()},l(o){e=$(o,"DIV",{class:!0});var r=P(e);O(t.$$.fragment,r),i=D(r),n=$(r,"P",{"data-svelte-h":!0}),M(n)!=="svelte-wupavy"&&(n.textContent=a),r.forEach(w),this.h()},h(){I(e,"class","loading-ai svelte-156sd")},m(o,r){L(o,e,r),H(t,e,null),v(e,i),v(e,n),h=!0},i(o){h||(F(t.$$.fragment,o),h=!0)},o(o){z(t.$$.fragment,o),h=!1},d(o){o&&w(e),q(t)}}}function ke(d){let e,t=[],i=new $e,n,a,h=X(d[2]);const o=c=>c[10].id;for(let c=0;c<h.length;c+=1){let l=te(d,h,c),g=o(l);i.set(g,t[c]=re(g,l))}let r=d[1]&&ae();return{c(){e=k("div");for(let c=0;c<t.length;c+=1)t[c].c();n=E(),r&&r.c(),this.h()},l(c){e=$(c,"DIV",{class:!0});var l=P(e);for(let g=0;g<t.length;g+=1)t[g].l(l);n=D(l),r&&r.l(l),l.forEach(w),this.h()},h(){I(e,"class","insights-grid svelte-156sd")},m(c,l){L(c,e,l);for(let g=0;g<t.length;g+=1)t[g]&&t[g].m(e,null);v(e,n),r&&r.m(e,null),a=!0},p(c,l){l&12&&(h=X(c[2]),N(),t=pe(t,l,o,1,c,h,i,e,me,re,n,te),G()),c[1]?r?l&2&&F(r,1):(r=ae(),r.c(),F(r,1),r.m(e,null)):r&&(N(),z(r,1,1,()=>{r=null}),G())},i(c){if(!a){for(let l=0;l<h.length;l+=1)F(t[l]);F(r),a=!0}},o(c){for(let l=0;l<t.length;l+=1)z(t[l]);z(r),a=!1},d(c){c&&w(e);for(let l=0;l<t.length;l+=1)t[l].d();r&&r.d()}}}function Te(d){let e,t,i,n,a,h,o,r="Personalized recommendations based on your trading patterns",c,l,g;return n=new le({props:{size:24}}),l=new ye({props:{feature:"ai-insights",userPlan:d[0],$$slots:{default:[ke]},$$scope:{ctx:d}}}),{c(){e=k("div"),t=k("div"),i=k("h2"),V(n.$$.fragment),a=B(`
			AI Trading Insights`),h=E(),o=k("p"),o.textContent=r,c=E(),V(l.$$.fragment),this.h()},l(_){e=$(_,"DIV",{class:!0});var u=P(e);t=$(u,"DIV",{class:!0});var m=P(t);i=$(m,"H2",{class:!0});var y=P(i);O(n.$$.fragment,y),a=W(y,`
			AI Trading Insights`),y.forEach(w),h=D(m),o=$(m,"P",{class:!0,"data-svelte-h":!0}),M(o)!=="svelte-1ert20n"&&(o.textContent=r),m.forEach(w),c=D(u),O(l.$$.fragment,u),u.forEach(w),this.h()},h(){I(i,"class","svelte-156sd"),I(o,"class","svelte-156sd"),I(t,"class","insights-header svelte-156sd"),I(e,"class","insights-container svelte-156sd")},m(_,u){L(_,e,u),v(e,t),v(t,i),H(n,i,null),v(i,a),v(t,h),v(t,o),v(e,c),H(l,e,null),g=!0},p(_,[u]){const m={};u&1&&(m.userPlan=_[0]),u&8198&&(m.$$scope={dirty:u,ctx:_}),l.$set(m)},i(_){g||(F(n.$$.fragment,_),F(l.$$.fragment,_),g=!0)},o(_){z(n.$$.fragment,_),z(l.$$.fragment,_),g=!1},d(_){_&&w(e),q(n),q(l)}}}function Ae(d){const e=[];if(d.length===0)return[{id:"start",type:"tip",title:"Get Started",message:"Start by adding your first trade to see personalized insights.",priority:"high"}];const t=d.filter(s=>s.pnl>0),i=d.filter(s=>s.pnl<0),n=t.length/d.length*100,a=t.length>0?t.reduce((s,f)=>s+f.pnl,0)/t.length:0,h=i.length>0?Math.abs(i.reduce((s,f)=>s+f.pnl,0)/i.length):0,o=h>0?a/h:0,r=new Map;d.forEach(s=>{if(s.strategy){const f=r.get(s.strategy)||{count:0,pnl:0,winRate:0};f.count++,f.pnl+=s.pnl,s.pnl>0&&f.winRate++,r.set(s.strategy,f)}});const c=new Map;d.forEach(s=>{const f=new Date(s.entryDate).getHours(),p=c.get(f)||{count:0,pnl:0};p.count++,p.pnl+=s.pnl,c.set(f,p)}),n>=70?e.push({id:"high-win-rate",type:"strength",title:"Excellent Win Rate",message:`Your win rate of ${n.toFixed(1)}% is exceptional. Focus on increasing position sizes on high-confidence trades.`,priority:"high",actionable:"Consider scaling up positions gradually"}):n<40&&e.push({id:"low-win-rate",type:"weakness",title:"Win Rate Needs Improvement",message:`Your win rate of ${n.toFixed(1)}% is below optimal. Review your entry criteria and consider being more selective.`,priority:"high",actionable:"Focus on quality over quantity"}),o<1.5&&n<60&&e.push({id:"poor-risk-reward",type:"weakness",title:"Risk-Reward Ratio Too Low",message:`Your risk-reward ratio of ${o.toFixed(2)} requires a high win rate. Consider targeting larger profits or tighter stops.`,priority:"high",actionable:"Aim for at least 2:1 reward-to-risk"});let l=null,g=0,_=null,u=100;r.forEach((s,f)=>{const p=s.winRate/s.count*100;p>g&&(l=f,g=p),p<u&&s.count>=5&&(_=f,u=p)}),l&&g>=60&&e.push({id:"best-strategy",type:"strength",title:"Top Performing Strategy",message:`Your "${l}" strategy has a ${g.toFixed(1)}% win rate. Consider allocating more capital to this approach.`,priority:"medium"}),_&&u<40&&e.push({id:"worst-strategy",type:"weakness",title:"Underperforming Strategy",message:`Your "${_}" strategy has only a ${u.toFixed(1)}% win rate. Consider refining or pausing this approach.`,priority:"medium",actionable:"Review and backtest this strategy"});let m=-1,y=0,A=0;if(c.forEach((s,f)=>{s.pnl>y&&s.count>=3&&(m=f,y=s.pnl),s.pnl<A&&s.count>=3&&(A=s.pnl)}),m>=0){const s=`${m}:00-${m+1}:00`;e.push({id:"best-time",type:"opportunity",title:"Optimal Trading Time",message:`You perform best during ${s}. Your total P&L during this hour is $${y.toFixed(2)}.`,priority:"low"})}let T=0;[...d].sort((s,f)=>new Date(s.exitDate).getTime()-new Date(f.exitDate).getTime()).forEach(s=>{s.pnl<0?T++:T=0}),T>=3&&e.push({id:"loss-streak",type:"weakness",title:"Active Loss Streak",message:`You've had ${T} consecutive losses. Consider taking a break to reset mentally and review your approach.`,priority:"high",actionable:"Take a break and review your recent trades"});const x=new Set(d.map(s=>new Date(s.entryDate).toDateString())).size,Y=d.length/x;return Y>10&&e.push({id:"overtrading",type:"weakness",title:"Possible Overtrading",message:`You average ${Y.toFixed(1)} trades per day. High frequency can lead to poor decision making and increased costs.`,priority:"medium",actionable:"Focus on quality setups only"}),d.length<20&&e.push({id:"more-data",type:"tip",title:"Build More Data",message:"Continue logging trades to get more accurate insights and identify patterns in your trading.",priority:"low"}),e.sort((s,f)=>{const p={high:0,medium:1,low:2};return p[s.priority]-p[f.priority]})}function oe(d){switch(d){case"strength":return"green";case"weakness":return"red";case"opportunity":return"blue";case"tip":return"yellow"}}function Ce(d,e,t){let i,{trades:n=[]}=e,{userPlan:a="free"}=e,{showAIInsights:h=!0}=e,o=null,r=null,c=!1;async function l(){if(!(!h||a==="free"))try{t(1,c=!0);const[u,m]=await Promise.all([ee.analyzePatterns().catch(()=>null),ee.getEmotionImpact().catch(()=>null)]);o=u,r=m}catch(u){console.error("Failed to fetch AI insights:",u)}finally{t(1,c=!1)}}function g(){const m=[...Ae(n)];if(o&&a!=="free"&&(o.patterns.slice(0,3).forEach((y,A)=>{m.push({id:`ai-pattern-${A}`,type:y.win_rate>60?"strength":"weakness",title:y.pattern_name,message:`${y.description} (${y.frequency} occurrences, ${y.win_rate.toFixed(1)}% win rate)`,priority:y.frequency>10?"high":"medium",actionable:y.win_rate>60?"Focus on this pattern":"Review and improve this pattern",isAI:!0})}),o.optimal_conditions&&m.push({id:"ai-optimal",type:"opportunity",title:"AI-Detected Optimal Trading Conditions",message:`Best performance during ${o.optimal_conditions.best_time} on ${o.optimal_conditions.best_day}. Top strategy: ${o.optimal_conditions.best_strategy}`,priority:"high",actionable:"Schedule your trading during these optimal times",isAI:!0})),r&&a==="enterprise"){const y=Object.entries(r.emotion_performance).sort(([,A],[,T])=>T.win_rate-A.win_rate)[0];y&&m.push({id:"ai-emotion",type:"tip",title:"Emotional State Impact",message:`You perform best when feeling "${y[0]}" (${y[1].win_rate.toFixed(1)}% win rate)`,priority:"medium",actionable:"Track your emotional state before trades",isAI:!0})}return m.sort((y,A)=>{const T={high:0,medium:1,low:2};return T[y.priority]-T[A.priority]}).slice(0,8)}de(()=>{n.length>0&&l()});function _(u){switch(u){case"strength":return be;case"weakness":return we;case"opportunity":return ve;case"tip":return _e}}return d.$$set=u=>{"trades"in u&&t(4,n=u.trades),"userPlan"in u&&t(0,a=u.userPlan),"showAIInsights"in u&&t(5,h=u.showAIInsights)},t(2,i=g()),[a,c,i,_,n,h]}class Me extends ue{constructor(e){super(),fe(this,e,Ce,Te,he,{trades:4,userPlan:0,showAIInsights:5})}}export{Me as T,Ve as t};

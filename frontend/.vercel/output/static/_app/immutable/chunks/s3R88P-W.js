import{a}from"./Dt6aPy9N.js";import{d as c,w as g}from"./BlAxCd93.js";function p(){const{subscribe:t,set:l,update:o}=g({user:null,loading:!0,error:null});return{subscribe:t,async login(e){o(r=>({...r,loading:!0,error:null}));try{const r=await a.post("/api/v1/auth/login",{username:e.username,password:e.password});if(console.log("Login response:",r),r.access_token){a.setAuthToken(r.access_token);const n=await a.get("/api/v1/auth/me");return o(s=>({...s,user:n,loading:!1,error:null})),{access_token:r.access_token,token_type:"bearer",user:n}}throw new Error("No access token received")}catch(r){throw o(n=>({...n,user:null,loading:!1,error:r.message||"Login failed"})),r}},async register(e){var r,n;o(s=>({...s,loading:!0,error:null}));try{console.log("Attempting to register with:",e);const s=await a.post("/api/v1/auth/register",e);return console.log("Registration successful:",s),await this.login({username:e.username,password:e.password})}catch(s){console.error("Registration error:",s);let i="Registration failed";throw(n=(r=s.detail)==null?void 0:r.details)!=null&&n.message?i=s.detail.details.message:s.message&&(i=s.message),o(u=>({...u,user:null,loading:!1,error:i})),s}},async logout(){a.clearAuth(),l({user:null,loading:!1,error:null})},async checkAuth(){if(!a.isAuthenticated()){l({user:null,loading:!1,error:null});return}o(e=>({...e,loading:!0}));try{const e=await a.get("/api/v1/auth/me");o(r=>({...r,user:e,loading:!1,error:null}))}catch{a.clearAuth(),l({user:null,loading:!1,error:null})}},clearError(){o(e=>({...e,error:null}))}}}const d=p(),w=c(d,t=>!!t.user),m={async verifyEmail(t){return a.post("/api/v1/auth/verify-email",null,{params:{token:t}})},async resendVerification(t){return a.post("/api/v1/auth/resend-verification",null,{params:{email:t}})},async requestPasswordReset(t){return a.post("/api/v1/auth/password-reset",{email:t})},async resetPassword(t,l){return a.post("/api/v1/auth/password-reset/confirm",{token:t,new_password:l})}};export{m as a,d as b,w as i};
